datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model user_login_info {
  username           String               @unique
  hash_password      String
  user_role          String
  diagnostician_info diagnostician_info[]
}

model doctor_info {
  username       String @unique
  name           String
  specialization String
  degree         String
  phone          String
  email          String
}

model receptionist_info {
  username String @unique
  name     String
  phone    String
}

model intern_info {
  username String @unique
  name     String
  phone    String
}

model patient_basic_info {
  id              Int                       @id @default(autoincrement())
  name            String
  phone           String                    @unique
  nid             String                    @unique
  dob             DateTime
  gender          String
  hometown        String
  addresses       String[]
  address_from    DateTime[]
  address_to      DateTime[]
  occupations     String[]
  occupation_from DateTime[]
  occupation_to   DateTime[]
  travel_history  String[]
  travel_from     DateTime[]
  travel_to       DateTime[]
  height          Float?
  weight          Float?
  bloodPressures  patient_blood_pressures[]
  heartRates      patient_heart_rates[]
  //   medicalHistory 	medical_history[]
  prescription    prescription[]
}

model patient_blood_pressures {
  id         Int                @id @default(autoincrement())
  patient    patient_basic_info @relation(fields: [patient_id], references: [id])
  patient_id Int
  taken_at   DateTime
  value_low  Int
  value_high Int
}

model patient_heart_rates {
  id         Int                @id @default(autoincrement())
  patient    patient_basic_info @relation(fields: [patient_id], references: [id])
  patient_id Int
  taken_at   DateTime
  value      Int
}

// model medical_history {
//   disease_id Int
//   date       DateTime
//   patient_id Int

//   diseases   diseases 			@relation(fields: [disease_id], references: [id])
//   patient    patient_basic_info @relation(fields: [patient_id], references: [id])

//   @@id([disease_id, date, patient_id])
//   @@index([disease_id], name: "disease_id")
//   @@index([patient_id], name: "patient_id")
// }

// model diseases {
//   id         			Int       @id @default(autoincrement())
//   disease_name       	String
//   symptoms   			String[]
//   is_chronic			String?   @map("is_chronic")
//   medical_history 		medical_history[]

//   @@index([disease_name], name: "disease_name")
// }

model medical_history {
  disease_id Int
  date       DateTime
  patient_id Int
  diseases   diseases @relation(fields: [disease_id], references: [id])

  @@id([disease_id, date, patient_id])
}

model diseases {
  id              Int               @id @default(autoincrement())
  disease_name    String
  is_chronic      String?
  medical_history medical_history[]
  disease_tag     disease_tag[]

  @@index([disease_name], name: "disease_name")
}

model prescription {
  id         Int                @id @default(autoincrement())
  patient_id Int
  date       DateTime?
  patient    patient_basic_info @relation(fields: [patient_id], references: [id])

  prescribed_tests prescribed_tests[]
  queued_tests     queued_tests[]
  prescribed_drugs prescribed_drugs[]

  @@index([patient_id], name: "patient_id")
}

model test_metadata {
  id          Int      @id @default(autoincrement())
  test_name   String
  row_name    String[]
  column_name String[]

  prescribed_tests prescribed_tests[]
  queued_tests     queued_tests[]
  tests_tag        tests_tag[]

  @@index([test_name], name: "test_name")
}

model prescribed_tests {
  prescription_id Int
  test_id         Int
  test_values     String[]
  attachments     String?
  date            DateTime?

  prescription prescription  @relation(fields: [prescription_id], references: [id])
  test         test_metadata @relation(fields: [test_id], references: [id])

  @@id([prescription_id, test_id])
}

model queued_tests {
  prescription_id Int
  test_id         Int

  prescription prescription  @relation(fields: [prescription_id], references: [id])
  test         test_metadata @relation(fields: [test_id], references: [id])

  @@id([prescription_id, test_id])
}

model prescribed_drugs {
  prescription_id   Int
  drug_id           Int
  prescribed_dosage String?

  prescription prescription @relation(fields: [prescription_id], references: [id])
  drug         brand_drugs  @relation(fields: [drug_id], references: [id])

  @@id([prescription_id, drug_id])
}

model generic_drugs {
  id              Int      @id @default(autoincrement())
  name            String
  usecases        String[]
  adverse_effects String[]

  brand_drugs brand_drugs[]
  drug_tag    drug_tag[]
}

model brand_drugs {
  id           Int    @id @default(autoincrement())
  generic_id   Int?
  name         String
  company      String
  adult_dosage String
  child_dosage String

  generic          generic_drugs?     @relation(fields: [generic_id], references: [id])
  prescribed_drugs prescribed_drugs[]
}

model drug_tag {
  drug_id Int
  tag_id  Int

  drug generic_drugs @relation(fields: [drug_id], references: [id])
  tag  tags          @relation(fields: [tag_id], references: [id])

  @@id([drug_id, tag_id])
}

model tags {
  id          Int           @id @default(autoincrement())
  tag_name    String        @unique
  disease_tag disease_tag[]
  surgery_tag surgery_tag[]
  drug_tag    drug_tag[]
  tests_tag   tests_tag[]
}

model disease_tag {
  disease_id Int
  tag_id     Int

  diseases diseases @relation(fields: [disease_id], references: [id])
  tags     tags     @relation(fields: [tag_id], references: [id])

  @@id([disease_id, tag_id])
}

model surgery_metadata {
  id           Int    @id @default(autoincrement())
  surgery_name String

  surgery_tag surgery_tag[]
}

model surgery_tag {
  surgery_id Int
  tag_id     Int

  surgery surgery_metadata @relation(fields: [surgery_id], references: [id])
  tags    tags             @relation(fields: [tag_id], references: [id])

  @@id([surgery_id, tag_id])
}

model tests_tag {
  test_id Int
  tag_id  Int
  tags    tags          @relation(fields: [tag_id], references: [id])
  test    test_metadata @relation(fields: [test_id], references: [id])

  @@id([test_id, tag_id])
}

model diagnostician_info {
  username String @id
  name     String
  phone    String

  user_login_info user_login_info @relation(fields: [username], references: [username])
}
